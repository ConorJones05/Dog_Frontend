{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/conor/dog-website/client/src/app/admin/page.tsx"],"sourcesContent":["'use client';\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport axios from 'axios';\r\nimport { \r\nChart as ChartJS, \r\nCategoryScale, \r\nLinearScale, \r\nBarElement, \r\nTitle, \r\nTooltip, \r\nLegend \r\n} from 'chart.js';\r\n\r\nChartJS.register(\r\nCategoryScale,\r\nLinearScale,\r\nBarElement,\r\nTitle,\r\nTooltip,\r\nLegend\r\n);\r\n\r\ninterface DashboardStatistics {\r\ntotal_dogs: number;\r\nunique_breeds: number;\r\nbreed_distribution: Record<string, number>;\r\ntotal_inventory_value: number;\r\naverage_price: number;\r\n}\r\n\r\n\r\ninterface Dog {\r\n  id: string;\r\n  name: string;\r\n  image: string;\r\n  breed: string;\r\n  price: number;\r\n}\r\n\r\nconst AdminPage = () => {\r\n  const router = useRouter();\r\n  const [dogs, setDogs] = useState<Dog[]>([]);\r\n  const [statistics, setStatistics] = useState<DashboardStatistics | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const [editingDog, setEditingDog] = useState<Dog | null>(null);\r\n  const [newDog, setNewDog] = useState({ name: '', image: '', breed: '', price: 0 });\r\n  const [showAddForm, setShowAddForm] = useState(false);\r\n\r\n  \r\n\r\n  const fetchDogs = async () => {\r\n    try {\r\n      setLoading(true);\r\n      let token = getToken();\r\n      if (!token) {\r\n        router.replace('/login');\r\n        return;\r\n      }\r\n  \r\n      const response = await axios.get('http://localhost:5000/admin/dashboard', {\r\n        headers: { Authorization: `Bearer ${token}` }\r\n      });\r\n  \r\n      setDogs(response.data.dogs);\r\n    } catch (err: any) {\r\n      console.error('Error fetching dogs:', err);\r\n  \r\n      if (err.response && err.response.status === 403) {\r\n        console.log(\"Unauthorized - attempting token refresh\");\r\n      // if (!token) {\r\n      //   router.replace('/login');\r\n      //   return;\r\n      // }\r\n        const session = localStorage.getItem('session');\r\n        const refreshToken = session ? JSON.parse(session).refresh_token : null;\r\n        if (refreshToken) {\r\n          try {\r\n            const refreshResponse = await axios.post('http://localhost:5000/refresh', { refresh_token: refreshToken });\r\n            localStorage.setItem('session', JSON.stringify(refreshResponse.data.session));\r\n            fetchDogs(); // Retry request with new token\r\n            return;\r\n          } catch (refreshError) {\r\n            console.error(\"Token refresh failed\", refreshError);\r\n          }\r\n        }\r\n  \r\n        localStorage.removeItem('session');\r\n        router.replace('/login');\r\n      } else {\r\n        setError('Failed to fetch dogs. Please try again.');\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n  \r\n\r\n\r\n  useEffect(() => {\r\n    const token = getToken();\r\n    if (!token) {\r\n      router.push('/login');\r\n    } else {\r\n      fetchDogs();\r\n      fetchStatistics();\r\n    }\r\n  }, []);\r\n\r\n  \r\n  const handleAddDog = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    try {\r\n      const token = getToken();\r\n      await axios.post('http://localhost:5000/admin', newDog, {\r\n        headers: { Authorization: `Bearer ${token}` }\r\n      });\r\n      fetchDogs();\r\n      fetchStatistics();\r\n    } catch (err) {\r\n      setError('Failed to add dog. Please try again.');\r\n    }\r\n  };\r\n\r\n  const handleUpdateDog = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!editingDog) return;\r\n    try {\r\n      const token = getToken();\r\n      await axios.put('http://localhost:5000/admin', editingDog, {\r\n        headers: { Authorization: `Bearer ${token}` }\r\n      });\r\n      setEditingDog(null);\r\n      fetchDogs();\r\n    } catch (err) {\r\n      setError('Failed to update dog. Please try again.');\r\n    }\r\n  };\r\n\r\n  const fetchStatistics = async () => {\r\n    try {\r\n      setLoading(true);\r\n      let token = getToken();\r\n      if (!token) {\r\n        router.replace('/login');\r\n        return;\r\n      }\r\n  \r\n      const response = await axios.get('http://localhost:5000/admin/statistics', {\r\n        headers: { Authorization: `Bearer ${token}` }\r\n      });\r\n  \r\n      setStatistics(response.data.statistics);\r\n    } catch (err: any) {\r\n      console.error('Error fetching statistics:', err);\r\n      setError('Failed to fetch statistics. Please try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n  const handleDeleteDog = async (id: string) => {\r\n    if (!window.confirm('Are you sure you want to delete this dog?')) return;\r\n    try {\r\n      const token = getToken();\r\n      await axios.delete('http://localhost:5000/admin', {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n        data: { id }\r\n      });\r\n      fetchDogs();\r\n    } catch (err) {\r\n      setError('Failed to delete dog. Please try again.');\r\n    }\r\n  };\r\n\r\n  if (loading) return <div className=\"flex justify-center p-8\">Loading...</div>;\r\n\r\n  return (\r\n    <div className=\"p-6\">\r\n      <h1 className=\"text-2xl font-bold mb-4\">Admin Dashboard - Dog Management</h1>\r\n      {error && <div className=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4\">{error}</div>}\r\n      <button\r\n        className=\"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded mb-4\"\r\n        onClick={() => setShowAddForm(prev => !prev)}\r\n      >\r\n        {showAddForm ? 'Cancel' : 'Add New Dog'}\r\n      </button>\r\n      {showAddForm && (\r\n        <form onSubmit={handleAddDog} className=\"mb-6 p-4 border rounded\">\r\n        </form>\r\n      )}\r\n      {editingDog && (\r\n        <form onSubmit={handleUpdateDog} className=\"mb-6 p-4 border rounded\">\r\n        </form>\r\n      )}\r\n      <div className=\"overflow-x-auto\">\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminPage;\r\n\r\nfunction getToken() {\r\n  if (typeof window !== 'undefined') {\r\n    try {\r\n      const session = localStorage.getItem('session');\r\n      if (!session) return null;\r\n      \r\n      const parsedSession = JSON.parse(session);\r\n      if (!parsedSession.access_token) return null;\r\n      \r\n      return parsedSession.access_token;\r\n    } catch (e) {\r\n      console.error('Error parsing session from localStorage', e);\r\n      localStorage.removeItem('session'); // Clear bad data\r\n      return null;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 257, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}